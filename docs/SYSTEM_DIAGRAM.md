# CareBridge System Diagram

## Complete Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     USER'S BROWSER                                                   â”‚
â”‚                                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                    REACT APPLICATION                                           â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                                    ROUTES (App.tsx)                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  /login â”€â”€â”€â”€â”€â–¶ LoginPage                    /patients â”€â”€â”€â”€â–¶ PatientsListPage            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  /register â”€â”€â–¶ RegisterPage                 /patients/:id â”€â–¶ PatientDetailsPage         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ DashboardPage                /surgery â”€â”€â”€â”€â”€â”€â–¶ SurgeryListPage            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                             /admissions â”€â”€â”€â–¶ AdmissionsPage              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                             /pharmacy â”€â”€â”€â”€â”€â–¶ PharmacyPage                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                             /billing â”€â”€â”€â”€â”€â”€â–¶ BillingPage                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                             ... (20+ routes)                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                          â”‚                                                    â”‚  â”‚
â”‚  â”‚                                          â–¼                                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                              REACT HOOKS (useDatabase.ts)                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  usePatients() â”€â”€â”€â”€â”€â”€â–¶ Live patient list with auto-refresh                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  usePatientWithDetails(id) â”€â”€â–¶ Patient + vitals + surgeries + admissions               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  useActiveAdmissions() â”€â”€â”€â”€â”€â”€â–¶ Current inpatients                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  useTodaySurgeries() â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Today's OR schedule                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  usePendingLabRequests() â”€â”€â”€â”€â–¶ Pending lab orders                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  useDashboardStats() â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Statistics for dashboard                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  âš¡ All hooks use Dexie's useLiveQuery for REAL-TIME updates                            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                          â”‚                                                    â”‚  â”‚
â”‚  â”‚                                          â–¼                                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                           DATABASE OPERATIONS (operations.ts)                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  PatientOps â”€â”€â”€â”€â”€â”€â”€â”€â–¶ getAll(), getById(), create(), update(), getWithDetails()        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  AdmissionOps â”€â”€â”€â”€â”€â”€â–¶ getActive(), getByPatient(), create(), discharge()               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  SurgeryOps â”€â”€â”€â”€â”€â”€â”€â”€â–¶ getScheduledToday(), getByPatient(), create()                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  LabRequestOps â”€â”€â”€â”€â”€â–¶ getPending(), getByPatient(), create(), update()                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  PrescriptionOps â”€â”€â”€â–¶ getPending(), getByPatient(), create()                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  InvoiceOps â”€â”€â”€â”€â”€â”€â”€â”€â–¶ getPending(), getByPatient(), create()                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ... (27 operation modules)                                                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                          â”‚                                                    â”‚  â”‚
â”‚  â”‚                                          â–¼                                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                                DEXIE ORM (db.ts)                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  class CareBridgeDatabase extends Dexie {                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    patients!: Table<Patient, string>;                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    surgeries!: Table<Surgery, string>;                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    admissions!: Table<Admission, string>;                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    vitalSigns!: Table<VitalSigns, string>;                                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    ... (33 tables)                                                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  }                                                                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Version 54 with indexed fields for fast queries                                        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                â”‚                                                    â”‚
â”‚                                                â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                      INDEXEDDB                                                 â”‚  â”‚
â”‚  â”‚                                   (Browser Storage)                                            â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚  â”‚ patients  â”‚ â”‚ surgeries â”‚ â”‚admissions â”‚ â”‚vital_signsâ”‚ â”‚lab_requestsâ”‚ â”‚prescriptionsâ”‚       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚  â”‚  wounds   â”‚ â”‚   burns   â”‚ â”‚  invoices â”‚ â”‚ nutrition â”‚ â”‚ discharge â”‚ â”‚    chat   â”‚        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â”‚  ... and 21 more tables (33 total)                                                           â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â”‚  ğŸ’¾ Data persists even when OFFLINE - no internet needed for core functionality              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â”‚ SYNC WHEN ONLINE
                                                 â”‚
                                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     CLOUD SYNC SERVICE                                               â”‚
â”‚                                   (cloudSyncService.ts)                                             â”‚
â”‚                                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                              BIDIRECTIONAL SYNC                                                â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â”‚  ğŸ“¤ PUSH TO CLOUD (pushAllToCloud)           ğŸ“¥ PULL FROM CLOUD (pullAllFromCloud)            â”‚  â”‚
â”‚  â”‚  â€¢ Read all local records                    â€¢ Fetch all cloud records                        â”‚  â”‚
â”‚  â”‚  â€¢ Upsert to Supabase                        â€¢ Update local IndexedDB                         â”‚  â”‚
â”‚  â”‚  â€¢ 33 tables synced                          â€¢ 33 tables synced                               â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â”‚  ğŸ”„ REAL-TIME SYNC (Supabase Realtime)                                                        â”‚  â”‚
â”‚  â”‚  â€¢ Subscribe to all table changes                                                              â”‚  â”‚
â”‚  â”‚  â€¢ Auto-update local DB on INSERT/UPDATE/DELETE                                               â”‚  â”‚
â”‚  â”‚  â€¢ Immediate reflection in UI via useLiveQuery                                                 â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â”‚  âš¡ SYNC TRIGGERS                                                                              â”‚  â”‚
â”‚  â”‚  â€¢ On app start (initCloudSync)                                                               â”‚  â”‚
â”‚  â”‚  â€¢ When device comes online                                                                   â”‚  â”‚
â”‚  â”‚  â€¢ Every 5 minutes (periodic sync)                                                            â”‚  â”‚
â”‚  â”‚  â€¢ Manual trigger (triggerSync)                                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â”‚ HTTPS/WSS
                                                 â”‚
                                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         SUPABASE CLOUD                                               â”‚
â”‚                              (PostgreSQL + Real-time + Auth + Storage)                              â”‚
â”‚                                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                   POSTGRESQL DATABASE                                          â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                                     33 TABLES                                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  CORE:           hospitals, users, patients                                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  CLINICAL:       vital_signs, clinical_encounters, surgeries, wounds, burn_assessments â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  LAB/PHARMACY:   lab_requests, prescriptions, investigations, histopathology_requests  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ADMISSION:      admissions, admission_notes, bed_assignments, discharge_summaries     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  TREATMENT:      treatment_plans, treatment_progress, ward_rounds                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  NUTRITION:      nutrition_assessments, nutrition_plans                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  COMMUNICATION:  chat_rooms, chat_messages, video_conferences                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  SPECIALIZED:    blood_transfusions, mdt_meetings, consumable_boms                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  BILLING:        invoices                                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  SYSTEM:         audit_logs, sync_status                                                â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â”‚  âœ… Row Level Security (RLS) enabled on all tables                                            â”‚  â”‚
â”‚  â”‚  âœ… Public access policies configured                                                         â”‚  â”‚
â”‚  â”‚  âœ… Performance indexes created                                                               â”‚  â”‚
â”‚  â”‚  âœ… 3 Views: active_patients, todays_surgeries, pending_investigations                       â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                   SUPABASE REALTIME                                            â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â”‚  WebSocket channels for each table:                                                           â”‚  â”‚
â”‚  â”‚  â€¢ patients-changes    â†’ broadcasts INSERT/UPDATE/DELETE to all clients                       â”‚  â”‚
â”‚  â”‚  â€¢ surgeries-changes   â†’ broadcasts INSERT/UPDATE/DELETE to all clients                       â”‚  â”‚
â”‚  â”‚  â€¢ admissions-changes  â†’ broadcasts INSERT/UPDATE/DELETE to all clients                       â”‚  â”‚
â”‚  â”‚  â€¢ ... (channels for all 33 tables)                                                           â”‚  â”‚
â”‚  â”‚                                                                                               â”‚  â”‚
â”‚  â”‚  ğŸ”” All connected clients receive real-time updates                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


                           â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                           â•‘        HOW IT ALL CONNECTS                 â•‘
                           â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
                           â•‘                                           â•‘
                           â•‘  1. User opens app                        â•‘
                           â•‘     â””â”€â–¶ React Router renders page         â•‘
                           â•‘                                           â•‘
                           â•‘  2. Page uses React Hook                  â•‘
                           â•‘     â””â”€â–¶ usePatients(), useAdmissions()    â•‘
                           â•‘                                           â•‘
                           â•‘  3. Hook calls Dexie via useLiveQuery     â•‘
                           â•‘     â””â”€â–¶ Reads from IndexedDB              â•‘
                           â•‘     â””â”€â–¶ UI updates automatically          â•‘
                           â•‘                                           â•‘
                           â•‘  4. User creates/edits data               â•‘
                           â•‘     â””â”€â–¶ PatientOps.create() called        â•‘
                           â•‘     â””â”€â–¶ Saved to IndexedDB instantly      â•‘
                           â•‘     â””â”€â–¶ useLiveQuery triggers UI update   â•‘
                           â•‘                                           â•‘
                           â•‘  5. If ONLINE:                            â•‘
                           â•‘     â””â”€â–¶ cloudSyncService pushes to cloud  â•‘
                           â•‘     â””â”€â–¶ Other clients receive via WS      â•‘
                           â•‘                                           â•‘
                           â•‘  6. If OFFLINE:                           â•‘
                           â•‘     â””â”€â–¶ Data saved locally only           â•‘
                           â•‘     â””â”€â–¶ Syncs when back online            â•‘
                           â•‘                                           â•‘
                           â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Module Dependency Graph

```
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚      main.tsx       â”‚
                                     â”‚  (Entry Point)      â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚                           â”‚
                    â–¼                           â–¼                           â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   AuthProvider  â”‚         â”‚     App.tsx     â”‚         â”‚  initCloudSync  â”‚
          â”‚   (Context)     â”‚         â”‚   (Routes)      â”‚         â”‚  (Sync Init)    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                          â”‚                           â”‚
                    â”‚                          â”‚                           â”‚
                    â–¼                          â–¼                           â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚    db.ts        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   Domain Pages  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ supabaseClient  â”‚
          â”‚  (IndexedDB)    â”‚         â”‚   (UI)          â”‚         â”‚  (Cloud)        â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–²                          â”‚
                    â”‚                          â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  operations.ts  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  useDatabase.ts â”‚
          â”‚  (CRUD)         â”‚         â”‚  (React Hooks)  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–²
                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   types/        â”‚
          â”‚  (TypeScript)   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Files Quick Reference

| File | Purpose | Imports From | Exports |
|------|---------|--------------|---------|
| `main.tsx` | App entry | App, AuthProvider, cloudSyncService | - |
| `App.tsx` | Routing | All page components | App |
| `db.ts` | DB schema | Dexie, types | db, CareBridgeDatabase |
| `operations.ts` | CRUD ops | db, types | PatientOps, AdmissionOps, etc. |
| `useDatabase.ts` | React hooks | operations, db | usePatients, useAdmissions, etc. |
| `cloudSyncService.ts` | Cloud sync | supabaseClient, db | initCloudSync, fullSync |
| `supabaseClient.ts` | Supabase client | @supabase/supabase-js | supabase, TABLES |
| `AuthContext.tsx` | Auth state | db, React | useAuth, AuthProvider |
